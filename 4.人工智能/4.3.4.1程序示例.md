# ç¨‹åºç¤ºä¾‹

::: tip
é˜…è¯»ç¨‹åºå¹¶è¿è¡Œ

å®Œæˆä¹ é¢˜
:::

::: tip ğŸ“¥
æœ¬èŠ‚é™„ä»¶ä¸‹è½½ <Download url="https://cdn.xyxsw.site/code/4-Lecture.zip"/>
:::

## Hospital(å±€éƒ¨æœç´¢)

```python
import random

class Space():
    def __init__(self, height, width, num_hospitals):
        """åˆ›å»ºä¸€ä¸ªå…·æœ‰ç»™å®šç»´åº¦çš„æ–°çŠ¶æ€ç©ºé—´"""
        self.height = height                  # é«˜åº¦
        self.width = width                    # å®½åº¦
        self.num_hospitals = num_hospitals    # åŒ»é™¢æ•°é‡
        self.houses = set()                   # ä½æˆ¿ä½ç½®é›†åˆ
        self.hospitals = set()                # åŒ»é™¢ä½ç½®é›†åˆ

    def add_house(self, row, col):
        """åœ¨çŠ¶æ€ç©ºé—´ä¸­çš„ç‰¹å®šä½ç½®æ·»åŠ ä½æˆ¿"""
        self.houses.add((row, col))

    def available_spaces(self):
        """è¿”å›ä½æˆ¿æˆ–åŒ»é™¢å½“å‰æœªä½¿ç”¨çš„æ‰€æœ‰å•å…ƒæ ¼"""
        # è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„å•å…ƒæ ¼
        candidates = set(
            (row, col)
            for row in range(self.height)
            for col in range(self.width)
        )
        # æ’é™¤æ‰€æœ‰ä½æˆ¿å’ŒåŒ»é™¢
        for house in self.houses:
            candidates.remove(house)
        for hospital in self.hospitals:
            candidates.remove(hospital)
        return candidates

    def hill_climb(self, maximum=None, image_prefix=None, log=False):
        """æ‰§è¡Œçˆ¬å±±ç®—æ³•æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ"""
        count = 0
        # ä»éšæœºåˆå§‹åŒ–çš„åŒ»é™¢ä½ç½®å¼€å§‹
        self.hospitals = set()
        for i in range(self.num_hospitals):
            self.hospitals.add(random.choice(list(self.available_spaces())))
        ...
        # æ‰§è¡Œç®—æ³•ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
        while maximum is None or count < maximum:
            count += 1
            best_neighbors = []
            best_neighbor_cost = None
            # è€ƒè™‘æ‰€æœ‰åŒ»é™¢ç§»åŠ¨
            for hospital in self.hospitals:
                # è€ƒè™‘ä¸€ä¸‹é‚£å®¶åŒ»é™¢çš„æ‰€æœ‰é‚»å±…
                for replacement in self.get_neighbors(*hospital):
                    # ç”Ÿæˆä¸€ç»„ç›¸é‚»çš„åŒ»é™¢
                    neighbor = self.hospitals.copy()
                    neighbor.remove(hospital)
                    neighbor.add(replacement)
                    # æ£€æŸ¥é‚»å±…æ˜¯å¦æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¥½çš„
                    cost = self.get_cost(neighbor)
                    if best_neighbor_cost is None or cost < best_neighbor_cost:
                        best_neighbor_cost = cost
                        best_neighbors = [neighbor]
                    elif best_neighbor_cost == cost:
                        best_neighbors.append(neighbor)
            # æ²¡æœ‰ä¸€ä¸ªé‚»å±…æ¯”ç›®å‰çš„çŠ¶æ€æ›´å¥½
            if best_neighbor_cost >= self.get_cost(self.hospitals):
                return self.hospitals
            # ç§»åŠ¨åˆ°ä»·å€¼æœ€é«˜çš„é‚»å±…
            else:
                ...
                self.hospitals = random.choice(best_neighbors)
            ...

    def random_restart(self, maximum, image_prefix=None, log=False):
        """å¤šæ¬¡é‡å¤çˆ¬å±±ç®—æ³•"""
        best_hospitals = None
        best_cost = None
        # é‡å¤çˆ¬å±±ç®—æ³•çš„å›ºå®šæ¬¡æ•°
        for i in range(maximum):
            hospitals = self.hill_climb()
            cost = self.get_cost(hospitals)
            if best_cost is None or cost < best_cost:
                best_cost = cost
                best_hospitals = hospitals
                ...
            else:
                ...
            ...
        return best_hospitals

    def get_cost(self, hospitals):
        """è®¡ç®—ä»ä½æˆ¿åˆ°æœ€è¿‘åŒ»é™¢çš„è·ç¦»æ€»å’Œ"""
        cost = 0
        for house in self.houses:
            cost += min(
                abs(house[0] - hospital[0]) + abs(house[1] - hospital[1])
                for hospital in hospitals
            )
        return cost

    def get_neighbors(self, row, col):
        """è¿”å›å°šæœªåŒ…å«ä½æˆ¿æˆ–åŒ»é™¢çš„é‚»å±…"""
        candidates = [
            (row - 1, col),
            (row + 1, col),
            (row, col - 1),
            (row, col + 1)
        ]
        neighbors = []
        for r, c in candidates:
            if (r, c) in self.houses or (r, c) in self.hospitals:
                continue
            if 0 <= r < self.height and 0 <= c < self.width:
                neighbors.append((r, c))
        return neighbors

    def output_image(self, filename):
        """ç”Ÿæˆæ‰€æœ‰æˆ¿å±‹å’ŒåŒ»é™¢çš„å›¾åƒï¼ˆä¸ä½œè¦æ±‚ï¼‰"""
        from PIL import Image, ImageDraw, ImageFont
        cell_size = 100
        cell_border = 2
        cost_size = 40
        padding = 10

        # Create a blank canvas
        img = Image.new(
            "RGBA",
            (self.width * cell_size,
             self.height * cell_size + cost_size + padding * 2),
            "white"
        )
        house = Image.open("assets/images/House.png").resize(
            (cell_size, cell_size)
        )
        hospital = Image.open("assets/images/Hospital.png").resize(
            (cell_size, cell_size)
        )
        font = ImageFont.truetype("assets/fonts/OpenSans-Regular.ttf", 30)
        draw = ImageDraw.Draw(img)

        for i in range(self.height):
            for j in range(self.width):

                # Draw cell
                rect = [
                    (j * cell_size + cell_border,
                     i * cell_size + cell_border),
                    ((j + 1) * cell_size - cell_border,
                     (i + 1) * cell_size - cell_border)
                ]
                draw.rectangle(rect, fill="black")

                if (i, j) in self.houses:
                    img.paste(house, rect[0], house)
                if (i, j) in self.hospitals:
                    img.paste(hospital, rect[0], hospital)

        # Add cost
        draw.rectangle(
            (0, self.height * cell_size, self.width * cell_size,
             self.height * cell_size + cost_size + padding * 2),
            "black"
        )
        draw.text(
            (padding, self.height * cell_size + padding),
            f"Cost: {self.get_cost(self.hospitals)}",
            fill="white",
            font=font
        )

        img.save(filename)

# åˆ›å»ºä¸€ä¸ªçŠ¶æ€ç©ºé—´å¹¶éšæœºæ·»åŠ ä½æˆ¿
s = Space(height=10, width=20, num_hospitals=3)
for i in range(15):
    s.add_house(random.randrange(s.height), random.randrange(s.width))
# ä½¿ç”¨å±€éƒ¨æœç´¢æ¥ç¡®å®šåŒ»é™¢ä½ç½®
hospitals = s.random_restart(maximum=100, image_prefix="hospitals", log=True)
```

## Production(çº¿æ€§è§„åˆ’)

```python
import scipy.optimize
# Objective Function: 50x_1 + 80x_2
# Constraint 1: 5x_1 + 2x_2 <= 20
# Constraint 2: -10x_1 + -12x_2 <= -90
result = scipy.optimize.linprog(
    [50, 80],  # Cost function: 50x_1 + 80x_2
    A_ub=[[5, 2], [-10, -12]],  # Coefficients for inequalities
    b_ub=[20, -90],  # Constraints for inequalities: 20 and -90
)
if result.success:
    print(f"X1: {round(result.x[0], 2)} hours")
    print(f"X2: {round(result.x[1], 2)} hours")
else:
    print("No solution")
```

## Schedule(çº¦æŸæ»¡è¶³)

```python
"""æ²¡æœ‰ä»»ä½•å¯å‘å¼æˆ–æ¨ç†çš„è‡ªç„¶å›æº¯æœç´¢"""
VARIABLES = ["A", "B", "C", "D", "E", "F", "G"]
CONSTRAINTS = [
    ("A", "B"),
    ("A", "C"),
    ("B", "C"),
    ("B", "D"),
    ("B", "E"),
    ("C", "E"),
    ("C", "F"),
    ("D", "E"),
    ("E", "F"),
    ("E", "G"),
    ("F", "G")
]

def backtrack(assignment):
    """è¿è¡Œå›æº¯æœç´¢ä»¥æŸ¥æ‰¾èµ‹å€¼"""
    # æ£€æŸ¥èµ‹å€¼æ˜¯å¦å®Œæˆ
    if len(assignment) == len(VARIABLES):
        return assignment
    # å°è¯•ä¸€ä¸ªæ–°å˜é‡
    var = select_unassigned_variable(assignment)
    for value in ["Monday", "Tuesday", "Wednesday"]:
        new_assignment = assignment.copy()
        new_assignment[var] = value
        if consistent(new_assignment):
            result = backtrack(new_assignment)
            if result is not None:
                return result
    return None

def select_unassigned_variable(assignment):
    """æŒ‰é¡ºåºé€‰æ‹©å°šæœªèµ‹å€¼çš„å˜é‡"""
    for variable in VARIABLES:
        if variable not in assignment:
            return variable
    return None


def consistent(assignment):
    """æ£€æŸ¥åˆ†é…æ˜¯å¦ä¸€è‡´"""
    for (x, y) in CONSTRAINTS:
        # ä»…è€ƒè™‘å˜é‡èµ‹å€¼éƒ½å·²æŒ‡å®šçš„å¼§
        if x not in assignment or y not in assignment:
            continue
        # å¦‚æœä¸¤è€…çš„å€¼ç›¸åŒï¼Œåˆ™ä¸ä¸€è‡´
        if assignment[x] == assignment[y]:
            return False
    # å¦‚æœæ²¡æœ‰ä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œé‚£ä¹ˆèµ‹å€¼æ˜¯ä¸€è‡´çš„
    return True

solution = backtrack(dict())
print(solution)
```

ä½¿ç”¨å‘½ä»¤`pip install python-constraint`å®‰è£… constraint åº“

```python
from constraint import *

problem = Problem()

# æ·»åŠ å˜é‡
problem.addVariables(
    ["A", "B", "C", "D", "E", "F", "G"],
    ["Monday", "Tuesday", "Wednesday"]
)

# æ·»åŠ çº¦æŸ
CONSTRAINTS = [
    ("A", "B"),
    ("A", "C"),
    ("B", "C"),
    ("B", "D"),
    ("B", "E"),
    ("C", "E"),
    ("C", "F"),
    ("D", "E"),
    ("E", "F"),
    ("E", "G"),
    ("F", "G")
]
for x, y in CONSTRAINTS:
    problem.addConstraint(lambda x, y: x != y, (x, y))

# Solve problem
for solution in problem.getSolutions():
    print(solution)
```

## Quiz

1. å¯¹äºä»¥ä¸‹å“ªä¸€é¡¹ï¼Œå³ä½¿å¤šæ¬¡é‡æ–°è¿è¡Œç®—æ³•ï¼Œä¹Ÿä¼šå§‹ç»ˆæ‰¾åˆ°ç›¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Ÿ
   å‡è®¾ä¸€ä¸ªé—®é¢˜çš„ç›®æ ‡æ˜¯æœ€å°åŒ–æˆæœ¬å‡½æ•°ï¼Œå¹¶ä¸”çŠ¶æ€ç©ºé—´ä¸­çš„æ¯ä¸ªçŠ¶æ€éƒ½æœ‰ä¸åŒçš„æˆæœ¬ã€‚
   1. Steepest-ascent hill-climbingï¼Œæ¯æ¬¡ä»ä¸åŒçš„åˆå§‹çŠ¶æ€å¼€å§‹
   2. Steepest-ascent hill-climbingï¼Œæ¯æ¬¡éƒ½ä»ç›¸åŒçš„åˆå§‹çŠ¶æ€å¼€å§‹
   3. Stochastic hill-climbingï¼Œæ¯æ¬¡ä»ä¸åŒçš„åˆå§‹çŠ¶æ€å¼€å§‹
   4. Stochastic hill-climbingï¼Œæ¯æ¬¡éƒ½ä»ç›¸åŒçš„åˆå§‹çŠ¶æ€å¼€å§‹
   5. æ— è®ºæ˜¯ steepest-ascent è¿˜æ˜¯ stochastic hill climbingï¼Œåªè¦ä½ æ€»æ˜¯ä»åŒä¸€ä¸ªåˆå§‹çŠ¶æ€å¼€å§‹
   6. æ— è®ºæ˜¯ steepest-ascent è¿˜æ˜¯ stochastic hill climbingï¼Œåªè¦æ¯æ¬¡éƒ½ä»ä¸åŒçš„åˆå§‹çŠ¶æ€å¼€å§‹
   7. æ²¡æœ‰ä»»ä½•ç‰ˆæœ¬çš„çˆ¬å±±ç®—æ³•èƒ½ä¿è¯æ¯æ¬¡éƒ½èƒ½å¾—åˆ°ç›¸åŒçš„è§£å†³æ–¹æ¡ˆ

2. ä¸‹é¢ä¸¤ä¸ªé—®é¢˜éƒ½ä¼šé—®ä½ å…³äºä¸‹é¢æè¿°çš„ä¼˜åŒ–é—®é¢˜ã€‚
    ä¸€ä½å†œæ°‘æ­£åœ¨å°è¯•ç§æ¤ä¸¤ç§ä½œç‰©ï¼Œ`ä½œç‰© 1` å’Œ`ä½œç‰© 2`ï¼Œå¹¶å¸Œæœ›å®ç°åˆ©æ¶¦æœ€å¤§åŒ–ã€‚å†œæ°‘å°†ä»ç§æ¤çš„æ¯è‹±äº©`ä½œç‰© 1` ä¸­è·å¾— 500 ç¾å…ƒçš„åˆ©æ¶¦ï¼Œä»ç§æ¤çš„æ¯è‹±äº©`ä½œç‰© 2` ä¸­è·å¾— 400 ç¾å…ƒçš„åˆ©æ¶¦ã€‚ç„¶è€Œï¼Œå†œæ°‘ä»Šå¤©éœ€è¦åœ¨æ—©ä¸Š 7 ç‚¹åˆ°æ™šä¸Š 7 ç‚¹ä¹‹é—´çš„ 12 ä¸ªå°æ—¶å†…å®Œæˆæ‰€æœ‰çš„ç§æ¤ã€‚ç§æ¤ä¸€è‹±äº©çš„`ä½œç‰© 1` éœ€è¦ 3 ä¸ªå°æ—¶ï¼Œç§æ¤ä¸€è‹±äº©`ä½œç‰© 2` éœ€è¦ 2 ä¸ªå°æ—¶ã€‚å†œæ°‘åœ¨ä¾›åº”æ–¹é¢ä¹Ÿå¾ˆæœ‰é™ï¼šä»–æœ‰è¶³å¤Ÿçš„ä¾›åº”ç§æ¤ 10 è‹±äº©çš„`ä½œç‰© 1`ï¼Œæœ‰è¶³å¤Ÿçš„èµ„æºç§æ¤ 4 è‹±äº©çš„`ä½œç‰© 2`ã€‚å‡è®¾å˜é‡ C1 è¡¨ç¤ºè¦ç§æ¤çš„`ä½œç‰© 1` çš„è‹±äº©æ•°ï¼Œå˜é‡ C2 è¡¨ç¤ºè¦ç§æ¤`ä½œç‰© 2` çš„è‹±äº©æ•°ã€‚

    å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæ˜¯æœ‰æ•ˆçš„ç›®æ ‡å‡½æ•°ï¼Ÿ

    1. 10 \* C1 + 4 \* C2
    2. -3 \* C1 - 2 \* C2
    3. 500 \* 10 \* C1 + 400 \* 4 \* C2
    4. 500 \* C1 + 400 \* C2
    5. C1 + C2

3. è¿™ä¸ªé—®é¢˜çš„åˆ¶çº¦å› ç´ æ˜¯ä»€ä¹ˆï¼Ÿ
    1. 3 \* C1 + 2 \* C2 <= 12, C1 <= 10, C2 <= 4
    2. 3 \* C1 + 2 \* C2 <= 12, C1 + C2 <= 14
    3. 3 \* C1 <= 10, 2 \* C2 <= 4
    4. C1 + C2 <= 12, C1 + C2 <= 14

4. ä¸‹é¢çš„é—®é¢˜å°†é—®ä½ ä»¥ä¸‹è€ƒè¯•å®‰æ’çº¦æŸæ»¡è¶³å›¾ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¯¾ç¨‹ã€‚æ¯é—¨è¯¾ç¨‹éƒ½ä¸å¯èƒ½çš„è€ƒè¯•æ—¥çš„åˆå§‹åŸŸç›¸å…³è”ï¼ˆå¤§å¤šæ•°è¯¾ç¨‹å¯èƒ½åœ¨å‘¨ä¸€ã€å‘¨äºŒæˆ–å‘¨ä¸‰ï¼›å°‘æ•°è¯¾ç¨‹å·²ç»è¢«é™åˆ¶åœ¨ä¸€å¤©å†…ï¼‰ã€‚ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¾¹æ„å‘³ç€è¿™ä¸¤ä¸ªè¯¾ç¨‹å¿…é¡»åœ¨ä¸åŒçš„æ—¥å­è¿›è¡Œè€ƒè¯•ã€‚

    åœ¨å¯¹æ•´ä¸ªé—®é¢˜æ»¡è¶³å¼§ä¸€è‡´æ€§ä¹‹åï¼Œå˜é‡ Cã€D å’Œ E çš„ç»“æœåŸŸæ˜¯ä»€ä¹ˆï¼Ÿ

    1. C çš„åŸŸæ˜¯\{Monï¼ŒTue\}ï¼ŒD çš„åŸŸæ˜¯\{Wed\}ï¼ŒE çš„åŸŸæ˜¯\{Mon\}
    2. C çš„åŸŸæ˜¯\{Mon\}ï¼ŒD çš„åŸŸæ˜¯\{Wed\}ï¼ŒE çš„åŸŸä¸º\{Tue\}
    3. C çš„åŸŸæ˜¯\{Mon\}ï¼ŒD çš„åŸŸæ˜¯\{Tue\}ï¼ŒE çš„åŸŸä¸º\{Wed\}
    4. C çš„åŸŸæ˜¯\{Mon\}ï¼ŒD çš„åŸŸæ˜¯\{Monï¼ŒWed\}ï¼ŒE çš„åŸŸæ˜¯\{Tueï¼ŒWed\}
    5. C çš„åŸŸæ˜¯\{Monï¼ŒTueï¼ŒWed\}ï¼ŒD çš„åŸŸæ˜¯\{Monï¼ŒWed\}ï¼ŒE çš„åŸŸæ˜¯\{Monï¼ŒTueï¼ŒWed\}
    6. C çš„åŸŸæ˜¯\{Mon\}ï¼ŒD çš„åŸŸæ˜¯\{Monï¼ŒWed\}ï¼ŒE çš„åŸŸæ˜¯\{Monï¼ŒTueï¼ŒWed\}
