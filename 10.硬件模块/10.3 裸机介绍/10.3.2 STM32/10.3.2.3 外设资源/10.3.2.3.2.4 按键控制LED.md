# æŒ‰é”®æ§åˆ¶LED

> Authorï¼šä½™ç”Ÿ

## ä¸€ã€å‡†å¤‡

### æ–°å»ºæ–‡ä»¶åŠæ–‡ä»¶å¤¹

![](../../../static/10.3.2.3.2.4.1.jpg)

## é…ç½®å·¥ç¨‹åŒ…å«è·¯å¾„

ä¸å†èµ˜è¿°ï¼Œ [çœ‹è¿™é‡Œ](./10.3.2.3.2.3%20èœ‚é¸£å™¨åº”ç”¨.md)

## äºŒã€ç¡¬ä»¶è¿æ¥

![](../../../static/10.3.2.3.2.4.2.jpg)

## ä¸‰ã€ä»£ç ç¼–å†™åŠè§£è¯»

## LED.h

```cpp
#ifndef __LED_H
#define __LED_H

void LED_Init(void);
void LED1_ON(void);
void LED1_OFF(void);
void LED1_Turn(void);
void LED2_ON(void);
void LED2_OFF(void);
void LED2_Turn(void);

#endif
```

## LED.c

```cpp
#include "stm32f10x.h"  // Device header

void LED_Init(void)  // åˆå§‹åŒ–ä¸¤ä¸ªLEDç”¨çš„å¼•è„šï¼ˆPA1 å’Œ PA2ï¼‰
{
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA, ENABLE);

    GPIO_InitTypeDef GPIO_InitStructure;
    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_2;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(GPIOA, &GPIO_InitStructure);

    GPIO_SetBits(GPIOA, GPIO_Pin_1 | GPIO_Pin_2);
}

void LED1_ON(void)  // æŠŠ PA1 å¼•è„šæ‹‰ä½,ç‚¹äº® LED1
{
    GPIO_ResetBits(GPIOA, GPIO_Pin_1);
}

void LED1_OFF(void)  // æŠŠ PA1 å¼•è„šæ‹‰é«˜,ä¸¤ç«¯ç”µå‹å·®æ¶ˆå¤±
{
    GPIO_SetBits(GPIOA, GPIO_Pin_1);
}

void LED1_Turn(void)  // ç¿»è½¬ LED1 çš„çŠ¶æ€
{
    if (GPIO_ReadOutputDataBit(GPIOA, GPIO_Pin_1) == 0) {
        GPIO_SetBits(GPIOA, GPIO_Pin_1);
    } else {
        GPIO_ResetBits(GPIOA, GPIO_Pin_1);
    }
}

void LED2_ON(void)  // ç‚¹äº® LED2
{
    GPIO_ResetBits(GPIOA, GPIO_Pin_2);
}

void LED2_OFF(void)  // ç†„ç­ LED2
{
    GPIO_SetBits(GPIOA, GPIO_Pin_2);
}

void LED2_Turn(void)  // ç¿»è½¬ LED2 çš„çŠ¶æ€
{
    if (GPIO_ReadOutputDataBit(GPIOA, GPIO_Pin_2) == 0) {
        GPIO_SetBits(GPIOA, GPIO_Pin_2);
    } else {
        GPIO_ResetBits(GPIOA, GPIO_Pin_2);
    }
}
```

## Key.h

```cpp
#ifndef __KEY_H
#define __KEY_H

void Key_Init(void);
uint8_t Key_GetNum(void);

#endif
```

## Key.c

```cpp
#include "Delay.h"
#include "stm32f10x.h"  // Device header

void Key_Init(void) {
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB, ENABLE);

    GPIO_InitTypeDef GPIO_InitStructure;
    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;
    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_1 | GPIO_Pin_11;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_Init(GPIOB, &GPIO_InitStructure);
}

uint8_t Key_GetNum(void) {
    uint8_t KeyNum = 0;
    if (GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_1) == 0) {
        Delay_ms(20);
        while (GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_1) == 0);
        Delay_ms(20);
        KeyNum = 1;
    }
    if (GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_11) == 0) {
        Delay_ms(20);
        while (GPIO_ReadInputDataBit(GPIOB, GPIO_Pin_11) == 0);
        Delay_ms(20);
        KeyNum = 2;
    }

    return KeyNum;
}
```

### 1. `Key_Init()` â€”â€” æŒ‰é”®å¼•è„šåˆå§‹åŒ–

ä½œç”¨ï¼š

- ç»™ GPIOB å¼€ç”µæºï¼ˆæ—¶é’Ÿä½¿èƒ½ï¼‰ï¼Œå› ä¸ºæŒ‰é”®æ¥åœ¨PB1å’ŒPB11ä¸Š
- è®¾ç½®è¿™ä¸¤ä¸ªå¼•è„šä¸º è¾“å…¥æ¨¡å¼ + ä¸Šæ‹‰ç”µé˜»ï¼ˆIPUï¼‰

 ä¸ºä»€ä¹ˆç”¨â€œä¸Šæ‹‰è¾“å…¥â€ï¼Ÿ

- ä¸Šæ‹‰ = å†…éƒ¨æ¥ä¸€ä¸ªâ€œå°å¼¹ç°§â€ï¼ŒæŠŠå¼•è„šé»˜è®¤æ‹‰åˆ°é«˜ç”µå¹³ï¼ˆ1ï¼‰
- æŒ‰ä¸‹æŒ‰é”®æ—¶ï¼Œå¼•è„šæ¥åœ° â†’ å˜æˆä½ç”µå¹³ï¼ˆ0ï¼‰
- æ‰€ä»¥ï¼šæ²¡æŒ‰ = 1ï¼ŒæŒ‰ä¸‹ = 0

 ç±»æ¯”ï¼šå°±åƒé—¨æœ‰ä¸ªå¼¹ç°§ï¼Œä¸æ¨å®ƒå°±è‡ªåŠ¨å…³ä¸Šï¼ˆé«˜ç”µå¹³ï¼‰ï¼Œä¸€æ¨å°±å¼€ï¼ˆä½ç”µå¹³ï¼‰

### 2. `Key_GetNum()` â€”â€” è·å–å“ªä¸ªæŒ‰é”®è¢«æŒ‰äº†

ä½œç”¨ï¼š

æ£€æŸ¥ä¸¤ä¸ªæŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹ï¼Œå¦‚æœæŒ‰äº†ï¼Œè¿”å›å¯¹åº”ç¼–å·ï¼š

- æŒ‰ä¸‹ PB1 â†’ è¿”å› 1
- æŒ‰ä¸‹ PB11 â†’ è¿”å› 2
- éƒ½æ²¡æŒ‰ â†’ è¿”å› 0

å®ƒæ˜¯æ€ä¹ˆåˆ¤æ–­çš„ï¼Ÿåˆ†å››æ­¥ï¼š

#### ç¬¬ä¸€æ­¥ï¼šè¯»å¼•è„šçŠ¶æ€

çœ‹ PB1 æˆ– PB11 æ˜¯ä¸æ˜¯å˜æˆäº† 0ï¼ˆè¯´æ˜å¯èƒ½è¢«æŒ‰ä¸‹äº†ï¼‰

#### ç¬¬äºŒæ­¥ï¼šå»¶æ—¶20msï¼ˆé˜²æŠ–ï¼‰

 æŒ‰é”®æœºæ¢°æŠ–åŠ¨é—®é¢˜ï¼š

ä½ æŒ‰ä¸€ä¸‹æŒ‰é’®ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ¬¡æ¥é€šï¼Œä½†å†…éƒ¨é‡‘å±ç‰‡ä¼šâ€œå¼¹å‡ ä¸‹â€ï¼Œäº§ç”Ÿå¤šä¸ªé«˜ä½ç”µå¹³è·³åŠ¨ï¼ˆå¯èƒ½è¢«è¯¯åˆ¤ä¸ºæŒ‰äº†å¤šæ¬¡ï¼‰ã€‚

è§£å†³åŠæ³•ï¼šå‘ç°æŒ‰é”®æŒ‰ä¸‹åï¼Œå…ˆç­‰ 20æ¯«ç§’ï¼Œè®©æŠ–åŠ¨ç»“æŸã€‚

#### ç¬¬ä¸‰æ­¥ï¼šæŒç»­ç­‰å¾…æ¾æ‰‹

```cpp
while (GPIO_ReadInputDataBit(...) == 0);
```

è¿™å¥çš„æ„æ€æ˜¯ï¼šä¸€ç›´å¡åœ¨è¿™é‡Œï¼Œç›´åˆ°æŒ‰é”®æ¾å¼€ä¸ºæ­¢ã€‚

ç›¸å½“äºï¼šä½ æŒ‰å®ŒæŒ‰é’®ï¼Œå¿…é¡»æ¾æ‰‹åç¨‹åºæ‰èƒ½ç»§ç»­ï¼Œé˜²æ­¢ä¸€ç›´è¿”å›â€œ1â€ã€‚

#### ç¬¬å››æ­¥ï¼šå†å»¶æ—¶20msï¼ˆç¨³å®šï¼‰

æ¾æ‰‹åå¯èƒ½è¿˜æœ‰æŠ–åŠ¨ï¼Œå†ç­‰20msï¼Œç¡®ä¿å®Œå…¨ç¨³å®šã€‚

æœ€åè®¾ç½® KeyNum = 1 æˆ– 2

> ğŸ” æ³¨æ„ï¼šä¸¤ä¸ªæŒ‰é”®æ˜¯ç”¨ `if` å•ç‹¬åˆ¤æ–­çš„ï¼Œä¸æ˜¯ `else if`ï¼Œæ‰€ä»¥ç†è®ºä¸Šå¯ä»¥åŒæ—¶æ£€æµ‹ä¸¤ä¸ªéƒ½æŒ‰ï¼ˆä½†è¿™é‡Œåä¸€ä¸ªä¼šè¦†ç›–å‰ä¸€ä¸ªï¼‰

### æ€è€ƒ

å¦‚æœä¸¤ä¸ªæŒ‰é”®åŒæ—¶æŒ‰ä¸‹ï¼Œæœ€ç»ˆåªè¿”å› 2ï¼Œå› ä¸ºç¬¬äºŒä¸ª `if` è¦†ç›–äº†å‰é¢çš„ç»“æœã€‚

å¦‚æœä½ æƒ³æ”¯æŒå¤šé”®åŒæ—¶è¯†åˆ«ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

## æ€»ç»“ä¸€å¥è¯

> è¿™æ®µä»£ç æ˜¯ç”¨æ¥åˆå§‹åŒ–ä¸¤ä¸ªæŒ‰é”®ï¼Œå¹¶æ£€æµ‹å“ªä¸ªè¢«æŒ‰ä¸‹çš„ã€‚å®ƒé€šè¿‡è®¾ç½®è¾“å…¥ä¸Šæ‹‰æ¨¡å¼è¯»å–ç”µå¹³ï¼ŒåŠ å…¥å»¶æ—¶é˜²æŠ–å’Œç­‰å¾…æ¾æ‰‹æœºåˆ¶ï¼Œç¡®ä¿æ¯æ¬¡æŒ‰ä¸‹åªè¯†åˆ«ä¸€æ¬¡ï¼Œç¨³å®šå¯é ã€‚

## main.c

```cpp
#include "Delay.h"
#include "Key.h"
#include "LED.h"
#include "stm32f10x.h"  // Device header

uint8_t KeyNum;  // æ³¨æ„ï¼ï¼ï¼

int main(void) {
    LED_Init();
    Key_Init();

    while (1) {
        KeyNum = Key_GetNum();
        if (KeyNum == 1) {
            LED1_Turn();
        }
        if (KeyNum == 2) {
            LED2_Turn();
        }
    }
}
```
