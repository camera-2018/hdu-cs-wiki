# Chapter 1: A Tour of Computer Systems è®¡ç®—æœºç³»ç»Ÿä¹‹æ—…

> A computer system consists of hardware and systems software that work together to run application programs. Specific implementations of systems change over time, but the underlying concepts do not. All computer systems have similar hardware and software components that perform similar functions. This book is written for programmers who want to get better at their craft by understanding how these components work and how they affect the correctness and performance of their programs.

è®©æˆ‘ä»¬å†æ¬¡å›å½’è¿™æœ¬ä¹¦çš„æ ‡é¢˜ï¼ŒCSAPPâ€”â€”Computer Systems: A Programmer's Perspectiveï¼Œä¹Ÿè®¸åœ¨æœªæ¥æˆ‘ä»¬ä¼šé€‰æ‹©å„å¼å„æ ·çš„å¼€å‘æ–¹å‘ï¼Œä¹Ÿè®¸æˆ‘ä»¬ä¼šåœ¨ä¸åŒæ¶æ„çš„ç³»ç»Ÿä¸Šè¿›è¡Œå·¥ä½œï¼Œä½†æ˜¯è®¸å¤šè®¡ç®—æœºåº•å±‚ç›¸å…³çš„äº‹ç‰©åœ¨çŸ­æœŸå†…ä¸ä¼šåŠ¨æ‘‡ã€‚è®¤è¯†åˆ°è½¯ä»¶æ˜¯å¦‚ä½•åœ¨è®¡ç®—æœºç³»ç»Ÿä¸‹ååŒå·¥ä½œï¼Œå¯¹æˆ‘ä»¬æˆä¸ºç¨‹åºå‘˜å¤§æœ‰è£¨ç›Šã€‚

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å›´ç»•å¤§å¤šæ•°çš„ç¬¬ä¸€ä¸ªCè¯­è¨€ç¨‹åºâ€”â€”helloworld å±•å¼€ï¼Œä»ä¸€ä¸ªç®€å•ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå»è§‚å¯Ÿè®¡ç®—æœºç³»ç»Ÿæ‰€å‚ä¸çš„æ–¹æ–¹é¢é¢

::: code-group

```c [hello.c]
#include <stdio.h>

int main() {
    printf("hello world\n");
    return 0;
}

```

:::

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image.png)

å½“æˆ‘ä»¬åœ¨ linux shell ä¸­æ•²ä¸‹

```shell
linux> gcc -o hello hello.c
```

è®¡ç®—æœºç³»ç»Ÿä¾¿æ‰§è¡Œäº†ä¸Šå›¾çš„æµç¨‹ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åçš„ç« èŠ‚ä¸­è¯¦ç»†åœ°å­¦ä¹ æ¯ä¸€æ­¥ã€‚

å¯¹äºå¤§å¤šæ•°åŒå­¦è€Œè¨€ï¼Œè¿è¡Œç¨‹åºä¸è¿‡æ˜¯ç‚¹ä¸€ä¸ªæŒ‰é’®ï¼Œç›¸ä¿¡å¯¹äºå¤§å¤šæ•°åŒå­¦è€Œè¨€åœ¨å‘½ä»¤è¡Œä¸­æ•²å‘½ä»¤éƒ½æ˜¯æä¸ºé™Œç”Ÿçš„ä½“éªŒã€‚å®é™…ä¸Šï¼Œå›¾å½¢åŒ–ç•Œé¢ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å¯¹å‘½ä»¤çš„æŠ½è±¡ã€‚å½“ä½ æœ‰ä¸€äº›ä¸ªæ€§åŒ–çš„éœ€æ±‚æ—¶ï¼Œå‘½ä»¤ä¸ºä½ æä¾›æ›´å¤šçš„å‚æ•°é€‰æ‹©ï¼ŒåŒæ—¶åœ¨ä¸€äº›é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå‘½ä»¤çš„å½¢å¼æœ‰åŠ©äºä½ ç†è§£åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè·å–æ›´å¤šä¿¡æ¯ã€‚è¿™ä¹Ÿä»ä¾§é¢ä½“ç°å‡ºåº•å±‚æ€ç»´å¯¹è®¡ç®—æœºå­¦ä¹ çš„å¥½å¤„ã€‚

å›åˆ°è¿™ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œç±»ä¼¼çš„ç–‘é—®ä¹Ÿå¯ä»¥æ˜¯ï¼Œæ—¢ç„¶è¿è¡Œä¸€æ®µç¨‹åºå¯ä»¥æ˜¯ç‚¹ä¸€ä¸ªæŒ‰é’®é‚£ä¹ˆç®€å•ï¼Œä¸ºä»€ä¹ˆæˆ‘è¿˜è¦äº†è§£è¿™å…¶ä¸­å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚ç›¸ä¿¡å„ä½å¯ä»¥åœ¨ä¹¦ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image1.png)

æœ‰è¶£çš„äº‹å®ï¼šåœ¨Linuxç³»ç»Ÿä¸­ï¼Œç¡¬ä»¶ä¹Ÿè¢«è§†ä¸ºä¸€ç§æ–‡ä»¶ã€‚è¿™ç§æ¦‚å¿µç§°ä¸º"ä¸€åˆ‡çš†æ–‡ä»¶"ï¼ˆEverything is a fileï¼‰ã€‚åœ¨Linuxä¸­ï¼Œç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚ç£ç›˜é©±åŠ¨å™¨ã€é”®ç›˜ã€é¼ æ ‡ç­‰ï¼‰éƒ½è¢«è¡¨ç¤ºä¸ºæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼æ¥è®¿é—®å’Œæ“ä½œè¿™äº›ç¡¬ä»¶è®¾å¤‡ã€‚è¿™ç§æ–‡ä»¶è¡¨ç¤ºæ–¹å¼ä½¿å¾—Linuxç³»ç»Ÿèƒ½å¤Ÿä»¥ç»Ÿä¸€çš„æ–¹å¼å¤„ç†ç¡¬ä»¶è®¾å¤‡å’Œå…¶ä»–æ–‡ä»¶ï¼Œæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ¥å£æ¥ç®¡ç†ç³»ç»Ÿèµ„æºã€‚

ä¸Šå›¾çš„å„ä¸ªç»“æ„å…¨ä¹¦çš†æœ‰æ‰€æ¶‰åŠï¼Œé‡ç‚¹å±•å¼€äº†å¯¹æˆ‘ä»¬ç¼–ç¨‹å½±å“è¾ƒå¤§çš„éƒ¨åˆ†ã€‚

é‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œhelloçš„æ—¶å€™ï¼Œéƒ½å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image2.png)

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡é”®ç›˜è¾“å…¥çš„æŒ‡ä»¤ç»è¿‡CPUå¤„ç†åä¼ è¾“ç»™ä¸»å­˜ï¼Œæ­¤æ—¶è¿™æ¡æŒ‡ä»¤ä»æ—§æ˜¯æ–‡æœ¬å½¢å¼ã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image3.png)

åœ¨å¤„ç†å™¨å®Œæˆè®¡ç®—åï¼Œç¨‹åºçš„ç»“æœè¢«å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¾—ç›Šäºä¸€ç§åä¸ºDMAçš„æŠ€æœ¯ï¼ˆDirectMemoryAccessï¼‰ç£ç›˜çš„æ•°æ®å¾—ä»¥ç›´æ¥è¿”å›ä¸»å­˜ã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image4.png)

æœ€åï¼Œä¸»å­˜åœ¨å¾—åˆ°ç»“æœä¹‹åè¿˜éœ€è¦å°†æ•°æ®å†æ¬¡ç»è¿‡CPUä¹‹æ‰‹ä¼ è¾“å›ä½ çš„å›¾å½¢ç•Œé¢ã€‚

è§‚å¯Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œä¸éš¾å‘ç°åœ¨è¿™ä¸ªå†—é•¿çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®ç»è¿‡äº†æ¼«é•¿çš„ä¼ è¾“è·¯å¾„ï¼Œå¯¹äºå¤§éƒ¨åˆ†ç¨‹åºå‘˜è€Œè¨€ï¼Œè¿™æ˜¯ä¸å¯è§çš„å¼€é”€ã€‚å®é™…ä¸Šï¼Œåœ¨å­¦ä¹ ç›¸å…³çŸ¥è¯†åï¼Œè¿™äº›å¼€é”€éƒ½æ˜¯å¯ä»¥é€šè¿‡è‰¯å¥½çš„ä»£ç å‡å°‘çš„ã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image5.png)

åœ¨è®¡ç®—æœºä¸­ï¼Œå­˜å‚¨ç»“æ„å°±åƒä¸€åº§å±±ï¼Œè¶Šå¾€ä¸Šï¼Œå­˜å‚¨ç©ºé—´è¶Šå°ä½†æ˜¯è¶Šå¿«ï¼Œè¶Šå¾€ä¸‹ï¼Œå­˜å‚¨ç©ºé—´è¶Šå¤§ä½†æ˜¯è¶Šæ…¢ã€‚

> ç²—ç•¥ä¸”ç›´è§‚è€Œè¨€ï¼Œå…¸å‹ç³»ç»Ÿä¸Šçš„ç£ç›˜é©±åŠ¨å™¨å¯èƒ½æ¯”ä¸»å†…å­˜å¤§ 1,000 å€ï¼Œä½†å¤„ç†å™¨ä»ç£ç›˜è¯»å–ä¸€ä¸ªå­—æ‰€éœ€çš„æ—¶é—´å¯èƒ½æ¯”ä»å†…å­˜ä¸­è¯»å–çš„æ—¶é—´é•¿ 10,000,000 å€ã€‚

è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è®©æˆ‘ä»¬çš„ç¨‹åºæ›´å¤šåœ°ä½¿ç”¨é«˜æ•ˆçš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ç¨‹åºé€Ÿåº¦çš„æå‡å¯èƒ½æ¯”ä»O(n^3)åˆ°O(n^2)è¿˜å¤¸å¼ ã€‚æˆ‘ä»¬å°†åœ¨ä¹‹åçš„å­¦ä¹ ä¸­å­¦ä¹ è¿™æ ·åšçš„æ–¹æ³•å’ŒåŸç†ã€‚

ä¹‹å‰æ‰€å±•ç¤ºçš„å…³äºhelloç¨‹åºæ‰§è¡Œçš„å†—é•¿è¿‡ç¨‹å¯èƒ½ä¼šè®©äººç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆä¸èƒ½è®©ç¨‹åºç›´æ¥è®¿é—®ç›¸å…³ç¡¬ä»¶å‘¢ã€‚

å› ä¸ºè¿™ä¾¿æ˜¯æ“ä½œç³»ç»Ÿçš„èŒè´£æ‰€åœ¨ï¼Œåº”ç”¨ç¨‹åºæ“ä½œç¡¬ä»¶çš„æ‰€æœ‰å°è¯•éƒ½è¦ç»è¿‡æ“ä½œç³»ç»Ÿã€‚è¿™æ ·åšæœ‰è¯¸å¤šå¥½å¤„ã€‚

> The operating system has two primary purposes: (1) to protect the hardware from misuse by runaway applications and (2) to provide applications with simple and uniform mechanisms for manipulating complicated and often wildly different low-level hardware devices. The operating system achieves both goals via the fundamental abstractions shown in Figure 1.11: processes, virtual memory, and files. As this figure suggests, files are abstractions for I/O devices, virtual memory is an abstraction for both the main memory and disk I/O devices, and processes are abstractions for the processor, main memory, and I/O devices. We will discuss each in turn.

å‡ºäºå®‰å…¨æ€§ï¼šé˜»æ­¢è½¯ä»¶å¯¹ç¡¬ä»¶ä¸åˆç†çš„è°ƒç”¨ã€‚

å‡ºäºå…¼å®¹æ€§ï¼šç¡¬ä»¶ç§ç±»å„å¼å„æ ·ï¼Œç»Ÿä¸€çš„æŠ½è±¡å±‚çº§å’Œæ•°æ®æ ¼å¼æœ‰åˆ©äºæ­£ç¡®åœ°è°ƒç”¨ä»–ä»¬ã€‚

åœ¨æœ¬ä¹¦æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç²—ç•¥äº†è§£è®¡ç®—æœºç³»ç»Ÿé¢å‘è½¯ç¡¬ä»¶çš„æŠ½è±¡ã€‚

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image6.png)

å¯¹äºæ¯ä¸€ä¸ªè¿›ç¨‹è€Œè¨€ï¼Œå®ƒè¢«åˆ†é…åˆ°ä¸€ä¸ªå¤„ç†å™¨ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ç‹¬å ï¼Œä½†æ˜¯è¶…çº¿ç¨‹ï¼ˆHyper-Threadingï¼‰æŠ€æœ¯ä¸‹å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªå¤„ç†å™¨åŒæ—¶å¤„ç†å¤šä¸ªè¿›ç¨‹ï¼ˆå®é™…ä¸Šä»æ˜¯åœ¨åŒä¸€æ—¶é—´ç‚¹å†…å¤„ç†ä¸åŒçš„æŒ‡ä»¤æµï¼‰ï¼‰

è·å¾—ä¸»å­˜ç©ºé—´ä¸€é€šè¿‡ç»™äºˆè™šæ‹Ÿå†…å­˜åˆ›é€ ç‹¬äº«ä¸»å­˜çš„å‡è±¡ï¼Œè¿™åœ¨ä¹‹åä¼šå­¦åˆ°ã€‚

æ•°ä¸ªç”¨äºè¯»å–çš„æ–‡ä»¶ï¼Œå®é™…ä¸Šç³»ç»Ÿçº§Oéƒ½æ˜¯ç»™äºˆæ–‡ä»¶è¿›è¡Œçš„ï¼Œç®€æ´å¼ºå¤§ä¸”é€šç”¨ã€‚

åœ¨10-12ç« ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç½‘ç»œç¼–ç¨‹çš„ç›¸å…³å†…å®¹

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image7.png)

ç½‘ç»œå¯¹äºè®¡ç®—æœºç³»ç»Ÿè€Œè¨€ä¹Ÿå¯ä»¥è§†ä½œä¸€ä¸ªç¡¬ä»¶ï¼Œåªæ˜¯è®¿é—®è¿™ä¸ªç¡¬ä»¶éœ€è¦é¢å¤–çš„è§„åˆ™ã€‚

åœ¨æ‰§è¡Œhelloæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰§è¡Œç¨‹åºå¹¶è¿”å›ç»“æœè¿™ä¸ªä»»åŠ¡äº¤ç»™ç½‘ç»œæœåŠ¡å™¨ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬å›å½’è¿™æœ¬ä¹¦çš„ä¸»é¢˜ï¼Œä¸ºä»€ä¹ˆç¨‹åºå‘˜éœ€è¦äº†è§£æ“ä½œç³»ç»Ÿçš„ç›¸å…³å†…å®¹ï¼Œå‡è®¾ä½ çš„ç®—æ³•å ç¨‹åºçš„ $2/3$ ï¼Œä½ ç°åœ¨é€šè¿‡è¯¥ä¸ºå¤©äººçš„åŠªåŠ›æå‡äº† $100%$ çš„é€Ÿåº¦ï¼ˆåŠ é€Ÿæ¯”é«˜è¾¾ $200%$ï¼‰ï¼Œç„¶è€Œå¯¹äºæ•´ä¸ªç¨‹åºè€Œè¨€ï¼Œä½ ä»…ä»…åŠ é€Ÿäº† $50%$ ï¼ˆåŠ é€Ÿæ¯”ä¸º $150%$ï¼‰è¿™è¯´æ˜ï¼Œä¸ºäº†æ˜¾è‘—åŠ å¿«æ•´ä¸ªç³»ç»Ÿçš„é€Ÿåº¦ï¼Œæˆ‘ä»¬å¿…é¡»æé«˜æ•´ä¸ªç³»ç»Ÿä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†çš„é€Ÿåº¦ã€‚è¿™æ­£æ˜¯é˜¿å§†è¾¾å°”å®šå¾‹çš„ä¸»è¦è§è§£ã€‚

å‡è®¾ç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†éœ€è¦æ—¶é—´çš„ä¸€å°éƒ¨åˆ†ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†å…¶æ€§èƒ½æé«˜äº† $k$ å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥éƒ¨åˆ†æœ€åˆéœ€è¦æ—¶é—´ ${\alpha}T_{old}$ ï¼Œç°åœ¨éœ€è¦æ—¶é—´ $ï¼ˆ{\alpha}T_{old}ï¼‰/k$ ã€‚å› æ­¤ï¼Œæ€»æ‰§è¡Œæ—¶é—´å°†æ˜¯

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image8.png)

åŠ é€Ÿæ¯”ä¸º

![ç¤ºä¾‹å›¾ç‰‡](../static/static1\image9.png)

åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å¤§é‡æåˆ°æŠ½è±¡è¿™ä¸€æ¦‚å¿µï¼Œé‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„æŠ½è±¡ï¼ˆAbstractï¼‰å‘¢ç®€å•è€Œè¨€ï¼ŒæŠ½è±¡å°±æ˜¯ä¸€ä¸ªé»‘ç®±ï¼Œä½ æä¾›è¾“å…¥ï¼Œå®ƒæä¾›è¾“å‡ºï¼Œå¯¹äºä½¿ç”¨è€…è€Œè¨€ä¸éœ€è¦æ¸…æ¥šå…¶åŸç†ï¼Œåªéœ€è¦æ¸…æ¥šå…¶åŠŸèƒ½ã€‚åŒæ—¶ï¼Œåœ¨å¤šæ•°æ—¶å€™ï¼Œä½¿ç”¨è€…å¹¶ä¸èƒ½ç›´æ¥å¹²æ¶‰é»‘ç®±çš„å†…éƒ¨è¿ä½œï¼Œè¿™è¢«ç§°ä¸ºæŠ½è±¡éšœç¢ï¼ˆAbstraction Barrierï¼‰ç”¨æ›´åŠ ç¨‹åºå‘˜çš„è¯æ¥è¯´

> The use of abstractions is one of the most important concepts in computer science. For example, one aspect of good programming practice is to formulate a simple application program interface (API) for a set of functions that allow programmers to use the code without having to delve into its inner workings. Different programming languages provide different forms and levels of support for abstraction, such as Java class declarations and C function prototypes.

è™½ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ”¹å˜æ“ä½œç³»ç»Ÿçš„æŠ½è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®å…¶åŸç†ç¼–å†™æ›´é€‚åº”å…¶è§„åˆ™çš„ä»£ç ã€‚

äº‹å®ä¸Šï¼Œåº”ç”¨è½¯ä»¶ã€ç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿä¹‹é—´çš„å‘å±•æ˜¯ç›¸è¾…ç›¸æˆçš„ï¼Œä¸‰æ–¹ä¸­ä¸€æ–¹çš„æ–°éœ€æ±‚ä¸æ–°çªç ´éƒ½ä¼šä¸ºäºŒè€…å¸¦æ¥æ–°å‘å±•ã€‚

ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œï¼Œä½ å·²ç»åšå¥½å¼€å¯ä¸€åœºæœ‰è¶£çš„è®¡ç®—æœºä¹‹æ—…çš„å‡†å¤‡ã€‚

::: tip ğŸ’¡æ€è€ƒé¢˜

- è®¡ç®—æœºä¸­çš„ä¸€åˆ‡æ•°æ®éƒ½ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å­˜å‚¨ï¼Œé‚£ä¹ˆå¯¹äºè®¡ç®—æœºç³»ç»Ÿè€Œè¨€ï¼Œå®ƒæœ‰å“ªäº›æ–¹æ³•ç¡®è®¤æ•°æ®çš„æ ¼å¼å’Œè§£è¯»æ–¹å¼ã€‚
- ä¸ºä»€ä¹ˆè®¡ç®—æœºçš„å­˜å‚¨ç»“æ„ä¸€å®šæ˜¯ç”±å°‘é‡é«˜é€Ÿä¸å¤§é‡ä½é€Ÿçš„å­˜å‚¨å•å…ƒç»„æˆçš„

:::
