# 11.è®¾ç½®æ¡ä»¶

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰å¯¹è±¡çš„å±æ€§éƒ½æ˜¯æ•°æ®ï¼šæ–‡æœ¬ã€æ•°å­—ã€‚ä½†å±æ€§ä¹Ÿå¯ä»¥æ˜¯ä»£ç ã€‚

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å…³é—­æ´ç©´å…¥å£ï¼ˆè¿›å…¥æ´ç©´çš„é€šé“ï¼‰æ¥é™åˆ¶ç©å®¶çš„è¡ŒåŠ¨è‡ªç”±ã€‚è¿™å·²ç»è®©æ¸¸æˆå˜å¾—æ›´æœ‰æŒ‘æˆ˜æ€§äº†ï¼Œä½†è¿™å¹¶æ²¡æœ‰å¸¦æ¥å¤šå°‘è°œé¢˜ï¼Œé™¤éæˆ‘ä»¬ä¸ºç©å®¶æä¾›ä¸€ä¸ªå¾®å°çš„å¯èƒ½æ€§æ¥æ‰“å¼€é€šé“ã€‚çœŸæ­£çš„æŒ‘æˆ˜åº”è¯¥æ˜¯è®©ç©å®¶æ‰¾åˆ°é€šé“æ‰“å¼€çš„æ¡ä»¶ã€‚

è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ä¸ºäº†è¶Šè¿‡å®ˆå«è¿›å…¥å±±æ´ï¼Œç©å®¶å¿…é¡»æ€æ­»æˆ–è´¿èµ‚å®ˆå«ï¼ˆæˆ–ä¸¤è€…å…¼è€Œæœ‰ä¹‹ï¼Œè¿™å¾ˆæœ‰ä»·å€¼ï¼‰ã€‚æ¢å¥è¯è¯´ï¼š

- å½“è­¦å«æ­»äº¡æ—¶ï¼ˆHP=0ï¼‰ï¼Œå…¥å£å¼€æ”¾
- å½“è­¦å«æ‹¿ç€é“¶å¸ (è´¿èµ‚è­¦å«) æ—¶ï¼Œå…¥å£å¼€æ”¾
- ä¸¤è€…éƒ½ä¸æ˜¯ï¼Œå…¥å£å…³é—­

æ‰“å¼€ä¸€ä¸ªå°é—­çš„é€šé“ï¼ˆåœ¨è¿™é‡Œæ˜¯è¿›å…¥æ´ç©´ï¼‰æ¶‰åŠåˆ°æ”¹å˜ä¸€äº›å±æ€§å€¼ï¼š

- ç›®çš„åœ°ä» NULL(ç©ºåœ°ç‚¹) å˜ä¸ºæ´ç©´
- **textGo**ä» "è­¦å«é˜»æ­¢ä½ ...... "æ”¹ä¸º "ä½ èµ°è¿›å±±æ´"
- åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæè¿°å’Œç»†èŠ‚ä¸éœ€è¦æ”¹å˜ã€‚ä½†å¯¹äºä¸€ä¸ªé—¨æ´æˆ–æ …æ ï¼Œå…¶ä¸­ä¹‹ä¸€ï¼ˆæˆ–ä¸¤è€…ï¼‰é€šå¸¸ä¼šåŒ…å«ä¸€äº›ä» "å¼€æ”¾ "åˆ° "å…³é—­ "çš„æ–‡å­—ã€‚

æœ‰è®¸å¤šæ–¹æ³•æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸€ç§ç®€å•ã€å¯ç»´æŠ¤å’Œé€šç”¨çš„æ–¹æ³•ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªç‹¬ç«‹çš„é€šé“ï¼šä¸€ä¸ªä»£è¡¨å¼€æ”¾é€šé“ï¼Œå¦ä¸€ä¸ªä»£è¡¨å°é—­é€šé“ã€‚é™¤äº†ä¸Šé¢åˆ—å‡ºçš„é‚£äº›ï¼Œè¿™ä¸¤æ¡é€šé“åœ¨æ¯ä¸€ä¸ªå±æ€§ä¸Šéƒ½æ˜¯ç›¸åŒçš„ã€‚(åœ¨ä½ ä¸‹é¢çœ‹åˆ°çš„ç”Ÿæˆçš„åœ°å›¾ä¸­ï¼Œæ³¨æ„æœ‰ä¸¤ä¸ªç®­å¤´é€šå‘æ´ç©´ï¼›ä¸€ä¸ªæ˜¯å®çº¿ï¼Œä¸€ä¸ªæ˜¯è™šçº¿)ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªåä¸ºæ¡ä»¶çš„æ–°å±æ€§ï¼Œå®ƒå†³å®šäº†æŸä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨ã€‚è¿™ä¸¤ä¸ªé€šé“å°†è¢«èµ‹äºˆäº’æ–¥çš„æ¡ä»¶ï¼Œå› æ­¤åœ¨ä»»ä½•æ—¶å€™éƒ½åªèƒ½æœ‰ä¸€ä¸ªå­˜åœ¨ã€‚

æ¯ä¸ªæ¡ä»¶å°†è¢«å®ç°ä¸ºä¸€ä¸ªå¸ƒå°”å‡½æ•°ï¼š**TRUE**æ„å‘³ç€è¯¥å¯¹è±¡å­˜åœ¨ï¼Œ**FALSE**æ„å‘³ç€å®ƒä¸å­˜åœ¨ã€‚

```c
bool intoCaveIsOpen(void)
{
   return guard->health == 0 || silver->location == guard;
}

bool intoCaveIsClosed(void)
{
   return guard->health > 0 && silver->location != guard;
}
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šä½ èƒ½ä»¿ç…§ä¸Šé¢ä¾‹å­è‡ªå·±å†™ä¸€äº›æ¡ä»¶å‡½æ•°å—ï¼Ÿ
:::

æ–°çš„å±æ€§æ¡ä»¶æ˜¯ä¸€ä¸ªæŒ‡å‘è¿™æ ·ä¸€ä¸ªå‡½æ•°çš„æŒ‡é’ˆã€‚

```c
bool (*condition)(void);
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å¼€å§‹ä¸º object.txt ä¸­çš„æ–°å±æ€§åˆ†é…å‡½æ•°ã€‚

## object.txt

```txt
- intoCave
     condition   intoCaveIsOpen
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     destination cave
     detail      "The entrance is just a narrow opening in a small outcrop.\n"
     textGo      "You walk into the cave.\n"

- intoCaveBlocked
     condition   intoCaveIsClosed
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     prospect    cave
     detail      "The entrance is just a narrow opening in a small outcrop.\n"
     textGo      "The guard stops you from walking into the cave.\n"
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šå°è¯•è‡ªå·±å®ç°ä¸Šé¢çš„ä¼ªä»£ç 
:::

è¿™ä¸¤ä¸ª "æ¡ä»¶ "å‡½æ•°æ˜¯å¦‚æ­¤å…·ä½“ï¼Œæ¯ä¸€ä¸ªæ¡ä»¶å‡½æ•°éƒ½åªç”¨è¿™ä¸€æ¬¡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬éœ€è¦çš„åœ°æ–¹å®šä¹‰è¿™äº›å‡½æ•°ã€‚è®¸å¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒåŒ¿åå‡½æ•°ï¼Œåƒè¿™æ ·ï¼š

```txt
- intoCave
     condition   { return guard->health == 0 || silver->location == guard; }
     ...

- intoCaveBlocked
     condition   { return guard->health > 0 && silver->location != guard; }
     ...
```

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠé¢å¤–çš„æ®µè½å’Œæ¡ä»¶æ·»åŠ åˆ° object.txt ä¸­ï¼Œå°±åƒå‰é¢è§£é‡Šçš„é‚£æ ·ã€‚

## new object.txt

```txt
#include <stdbool.h>
#include <stdio.h>
#include "object.h"

typedef struct object {
   bool         (*condition)(void);
   const char    *description;
   const char   **tags;
   struct object *location;
   struct object *destination;
   struct object *prospect;
   const char    *details;
   const char    *contents;
   const char    *textGo;
   int            weight;
   int            capacity;
   int            health;
} OBJECT;

extern OBJECT objs[];

- field
     description "an open field"
     tags        "field"
     details     "The field is a nice and quiet place under a clear blue sky."
     capacity    9999

- cave
     description "a little cave"
     tags        "cave"
     details     "The cave is just a cold, damp, rocky chamber."
     capacity    9999

- silver
     description "a silver coin"
     tags        "silver", "coin", "silver coin"
     location    field
     details     "The coin has an eagle on the obverse."
     weight      1

- gold
     description "a gold coin"
     tags        "gold", "coin", "gold coin"
     location    cave
     details     "The shiny coin seems to be a rare and priceless artefact."
     weight      1

- guard
     description "a burly guard"
     tags        "guard", "burly guard"
     location    field
     details     "The guard is a really big fellow."
     contents    "He has"
     health      100
     capacity    20

- player
     description "yourself"
     tags        "yourself"
     location    field
     details     "You would need a mirror to look at yourself."
     contents    "You have"
     health      100
     capacity    20

- intoCave
     condition   { return guard->health == 0 || silver->location == guard; }
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     destination cave
     details     "The entrance is just a narrow opening in a small outcrop."
     textGo      "You walk into the cave."

- intoCaveBlocked
     condition   { return guard->health > 0 && silver->location != guard; }
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     prospect    cave
     details     "The entrance is just a narrow opening in a small outcrop."
     textGo      "The guard stops you from walking into the cave."

- exitCave
     description "an exit to the west"
     tags        "west", "exit"
     location    cave
     destination field
     details     "Sunlight pours in through an opening in the cave's wall."
     textGo      "You walk out of the cave."

- wallField
     description "dense forest all around"
     tags        "west", "north", "south", "forest"
     location    field
     details     "The field is surrounded by trees and undergrowth."
     textGo      "Dense forest is blocking the way."

- wallCave
     description "solid rock all around"
     tags        "east", "north", "south", "rock"
     location    cave
     details     "Carved in stone is a secret password 'abccb'."
     textGo      "Solid rock is blocking the way."
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šå°è¯•è‡ªå·±å®ç°è¿™äº›åŠŸèƒ½ï¼Œå¹¶çœ‹çœ‹ä¸ä½ ä¹‹å‰è®¾è®¡çš„æœ‰ä½•ä¸åŒ
:::

ä¸ºäº†ä½¿è¿™äº›æ¡ä»¶å‘æŒ¥ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´å‡½æ•° isHolding å’Œ getDistanceã€‚

## misc.c

```c
#include <stdbool.h>
#include <stdio.h>
#include "object.h"
#include "misc.h"

bool isHolding(OBJECT *container, OBJECT *obj)
{
   return validObject(obj) && obj->location == container;
}

OBJECT *getPassage(OBJECT *from, OBJECT *to)
{
   if (from != NULL && to != NULL)
   {
      OBJECT *obj;
      for (obj = objs; obj < endOfObjs; obj++)
      {
         if (isHolding(from, obj) && obj->prospect == to)
         {
            return obj;
         }
      }
   }
   return NULL;
}

DISTANCE getDistance(OBJECT *from, OBJECT *to)
{
   return to == NULL                               ? distUnknownObject :
          !validObject(to)                         ? distNotHere :
          to == from                               ? distSelf :
          isHolding(from, to)                      ? distHeld :
          isHolding(to, from)                      ? distLocation :
          isHolding(from->location, to)            ? distHere :
          isHolding(from, to->location)            ? distHeldContained :
          isHolding(from->location, to->location)  ? distHereContained :
          getPassage(from->location, to) != NULL   ? distOverthere :
                                                     distNotHere;
}

OBJECT *actorHere(void)
{
   OBJECT *obj;
   for (obj = objs; obj < endOfObjs; obj++)
   {
      if (isHolding(player->location, obj) && obj != player &&
          obj->health > 0)
      {
         return obj;
      }
   }
   return NULL;
}

int listObjectsAtLocation(OBJECT *location)
{
   int count = 0;
   OBJECT *obj;
   for (obj = objs; obj < endOfObjs; obj++)
   {
      if (obj != player && isHolding(location, obj))
      {
         if (count++ == 0)
         {
            printf("%s:\n", location->contents);
         }
         printf("%s\n", obj->description);
      }
   }
   return count;
}
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šæƒ³æƒ³æˆ‘ä»¬è°ƒæ•´äº†ä»€ä¹ˆ
:::

æ³¨æ„ï¼š

1. è­¦å«ä¸å¯èƒ½ä¼šæ­»ï¼Œæ‰€ä»¥å¯ä»¥è¯´æˆ‘ä»¬çš„æ¡ä»¶å‡½æ•°ä¸­çš„**HP**æ˜¯å¾ˆæ— ç”¨çš„ã€‚å½“ç„¶ï¼Œè¿™å¾ˆå®¹æ˜“é€šè¿‡æ·»åŠ ä¸€ä¸ª kill å‘½ä»¤æ¥è§£å†³ï¼Œè§ç¬¬ 20 ç« ã€‚
2. è¿™ä¸¤ä¸ªæ¡ä»¶å‡½æ•°æ˜¯äº’è¡¥çš„ï¼›å®ƒä»¬æœ‰èµ„æ ¼æˆä¸ºé‡å¤çš„ä»£ç ã€‚ä¸ºäº†æ¶ˆé™¤è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½å†³å®šè®©ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼ˆç”¨'ï¼'æ“ä½œç¬¦æ¥å¦å®šç»“æœï¼‰ã€‚ä¸€ä¸ªåŒ¿åå‡½æ•°æ²¡æœ‰ï¼ˆç¨³å®šçš„ï¼‰åå­—ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨å®ƒçš„å¯¹è±¡æ¥æŒ‡ä»£å®ƒã€‚æˆ‘ä»¬å¯ä»¥ç”¨ intoCaveBlocked çš„æ¡ä»¶å‡½æ•°ä»£æ›¿ã€‚
3. ä¸ºäº†ç®€å•èµ·è§ï¼Œæ¡ä»¶å‡½æ•°æ²¡æœ‰å‚æ•°ã€‚å®é™…ä¸Šï¼Œä¼ é€’ä¸€ä¸ªå‚æ•° OBJECT *obj å¯èƒ½æ›´å¥½ï¼›è¿™ä½¿å¾—ç¼–å†™æ›´å¤šçš„é€šç”¨æ¡ä»¶å‡½æ•°æˆä¸ºå¯èƒ½ï¼Œå¯ä»¥åœ¨å¤šä¸ªå¯¹è±¡ä¸­é‡å¤ä½¿ç”¨ã€‚
4. åœ¨ç†è®ºä¸Šï¼Œä»»ä½•å¯¹è±¡éƒ½å¯ä»¥æˆä¸º "æ¡ä»¶"ã€‚åœ¨ä¸‹ä¸€ç« ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼çš„æŠ€æœ¯è¢«åº”ç”¨äºæ­¤ã€‚

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šæƒ³ä¸€æƒ³ä¸Šé¢ç¬¬äºŒç‚¹è¦æ€ä¹ˆç”¨ C æ¥å®ç°ï¼Ÿ
:::

è¾“å‡ºæ ·ä¾‹

Welcome to Little Cave Adventure.
You are in an open field.
You see:
a silver coin
a burly guard
a cave entrance to the east
dense forest all around

--> go entrance
The guard stops you from walking into the cave.

--> get coin
You pick up a silver coin.

--> give coin
You give a silver coin to a burly guard.

--> go entrance
You walk into the cave.

You are in a little cave.
You see:
a gold coin
an exit to the west
solid rock all around

--> quit

Bye!
