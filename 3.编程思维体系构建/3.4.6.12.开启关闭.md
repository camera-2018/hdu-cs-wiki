# 12.å¼€å¯å…³é—­

åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ "æ¡ä»¶ "å‡½æ•°æ¥ä½¿å¯¹è±¡æ¶ˆå¤±ã€‚å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•æ¥å®ç°åŒæ ·çš„ç›®çš„ï¼šåªè¦æ¸…é™¤å¯¹è±¡çš„ä½ç½®å±æ€§å°±å¯ä»¥äº†ï¼

æ´å£æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œæ¡ä»¶å‡½æ•°åœ¨é‚£é‡Œå·¥ä½œå¾—ç‰¹åˆ«å¥½ã€‚è¿™æ˜¯å› ä¸ºå…¥å£å—åˆ°å…¶ä»–å¯¹è±¡ï¼ˆå®ˆå«å’Œé“¶å¸ï¼‰ä¸­çš„å±æ€§çš„å½±å“ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°ä½¿å¾—æ‰€æœ‰çš„é€»è¾‘éƒ½èƒ½ä¿æŒä¸€è‡´ã€‚

è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªæ›´ç›´æ¥çš„ä¾‹å­ã€‚å‡è®¾å±±æ´æœ‰ä¸€æ‰‡é—¨é€šå‘ä¸€ä¸ªå¯†å®¤ã€‚åªæ˜¯ä¸€ä¸ªç®€å•çš„é—¨æ´ï¼Œç©å®¶å¯ä»¥æ‰“å¼€å’Œå…³é—­ã€‚å°±åƒå‰ä¸€ç« ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªå¯¹è±¡æ¥è¡¨ç¤ºè¿™ä¸ªé€šé“ï¼›ä¸€ä¸ªè¡¨ç¤ºæ‰“å¼€çš„é—¨ï¼Œå¦ä¸€ä¸ªè¡¨ç¤ºé—¨å…³é—­æ—¶ã€‚

```txt
- backroom
     description "a backroom"
     tags        "backroom"
     details     "The room is dusty and messy.\n"

- openDoorToBackroom
     description "an open door to the south"
     tags        "south", "door", "doorway"
     destination backroom
     details     "The door is open.\n"
     textGo      "You walk through the door into the backroom.\n"

- closedDoorToBackroom
     description "a closed door to the south"
     tags        "south", "door", "doorway"
     location    cave
     prospect    backroom
     details     "The door is closed.\n"
     textGo      "The door is closed.\n"
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šå°è¯•è‡ªå·±ç”¨ C è¯­è¨€å®ç°
:::

è‡ªç„¶ï¼Œé—¨ä¹Ÿåº”è¯¥èƒ½ä»å¦ä¸€ä¾§è¿›å…¥ã€‚

```txt
- openDoorToCave
     description "an open door to the north"
     tags        "north", "door", "doorway"
     destination cave
     details     "The door is open.\n"
     textGo      "You walk through the door into the cave.\n"

- closedDoorToCave
     description "a closed door to the north"
     tags        "north", "door", "doorway"
     location    backroom
     prospect    cave
     details     "The door is closed.\n"
     textGo      "The door is closed.\n"
```

æ³¨æ„æˆ‘ä»¬åªç»™å°é—­çš„é—¨æ´ä¸€ä¸ªä½ç½®ï¼Œå¼€æ”¾çš„é—¨æ´æ²¡æœ‰ã€‚æ‰€ä»¥ä¸€å¼€å§‹ï¼Œé—¨æ˜¯å…³é—­çš„ï¼ˆå› æ­¤ä½ åœ¨å³è¾¹çœ‹åˆ°çš„ç”Ÿæˆçš„åœ°å›¾ä¸­ï¼Œå±±æ´å’Œå¯†å®¤ä¹‹é—´æœ‰è™šçº¿ç®­å¤´ï¼‰ã€‚è¦æ‰“å¼€é—¨ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯äº¤æ¢ä½ç½®ã€‚

```c
openDoorToBackroom->location = cave;
closedDoorToBackroom->location = NULL;
openDoorToCave->location = backroom;
closedDoorToCave->location = NULL;
```

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥é€‚åº”è¿™ç§æƒ…å†µã€‚

```c
void swapLocations(OBJECT *obj1, OBJECT *obj2)
{
   OBJECT *tmp = obj1->location;
   obj1->location = obj2->location;
   obj2->location = tmp;
}
```

ç°åœ¨å¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥æ¥æ‰“å¼€è¿™æ‰‡é—¨ï¼›ä¸€æ—¦å®ƒè¢«æ‰“å¼€ï¼ŒåŒæ ·çš„è¯­å¥å°†å†æ¬¡å…³é—­å®ƒã€‚

```c
swapLocations(openDoorToBackroom, closedDoorToBackroom);
swapLocations(openDoorToCave, closedDoorToCave);
```

å‡½æ•° swapLocations ä¸ä¾èµ–äºå›ºå®šçš„ä½ç½®ï¼Œå› ä¸ºå®ƒåœ¨ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ¥å›ä¼ é€’å½“å‰ä½ç½®ã€‚

å½“ç›¸å…³å¯¹è±¡æ˜¯å¯ç§»åŠ¨çš„æ—¶å€™ï¼Œè¾…åŠ©åŠŸèƒ½å°±ç‰¹åˆ«æ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç›’å­å¯ä»¥è¢«æ‰“å¼€å’Œå…³é—­ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥è¢«æ‹¿èµ·å¹¶ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹çš„ç‰©å“ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒçš„ä½ç½®æ˜¯ä¸å›ºå®šçš„ã€‚

å½“ç„¶ï¼Œä¸€ä¸ªç›’å­ä¸æ˜¯ä¸€ä¸ªé€šé“ï¼šç©å®¶æ€»æ˜¯åœ¨ç›’å­å¤–é¢ã€‚æ‰€ä»¥ä¸€å¯¹ç‰©ä½“å°±å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€æ¬¡ swapLocations å‡½æ•°å°±å¤Ÿäº†ã€‚

```c
swapLocations(openBox, closedBox);
```

è¿™æˆ–å¤šæˆ–å°‘æ˜¯æˆ‘ä»¬å®ç°ä¸€äº›æ–°å‘½ä»¤ open å’Œ close æ‰€éœ€è¦çš„ã€‚ä¸‹é¢æ˜¯ open çš„ä¸€ä¸ªç®€å•å®ç°ï¼›close çš„å®ç°ä¹Ÿç±»ä¼¼ã€‚

```c
OBJECT *obj = parseObject(noun);
if (obj == closedDoorToBackRoom || obj == closedDoorToCave)
{
   swapLocations(openDoorToBackroom, closedDoorToBackroom);
   swapLocations(openDoorToCave, closedDoorToCave);
   printf("OK.\n");
}
else if (obj == closedBox)
{
   swapLocations(openBox, closedBox);
   printf("OK.\n");
}
else if (obj == openDoorToBackRoom || obj == openDoorToCave || obj == openBox)
{
   printf("That is already open.\n");
}
else
{
   printf("That cannot be opened.\n");
}
```

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼šä½ èƒ½ä¸èƒ½ä»¿ç…§ä¸Šé¢çš„ä»£ç å®ç° close åŠŸèƒ½ï¼Ÿ
:::

ä¸ºäº†ä½¿äº‹æƒ…ç¨å¾®å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é—¨ä¸Šæˆ–ç›’å­ä¸ŠåŠ ä¸€æŠŠé”ã€‚è¿™éœ€è¦ï¼ˆè‡³å°‘ï¼‰ä¸‰ä¸ªç›¸äº’æ’æ–¥çš„å¯¹è±¡ï¼›æ¯ä¸ªå¯èƒ½çš„çŠ¶æ€éƒ½æœ‰ä¸€ä¸ªï¼šæ‰“å¼€ã€å…³é—­å’Œé”å®šã€‚ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°æ¥äº¤æ¢å¯¹è±¡çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯å¦‚ä½•è§£é”ä¸€ä¸ªä¸Šé”çš„ç›’å­ï¼›åä¹‹äº¦ç„¶ã€‚

```c
swapLocations(closedBox, lockedBox);
```

ä½†è¿™ä»…ä»…æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬å¯¹å‘½ä»¤ open çš„å®ç°å¿…é¡»è¿›è¡Œæ‰©å±•ï¼Œä»¥å¤„ç†æ–°çš„å¯¹è±¡ lockedBoxã€‚

```c
...
else if (obj == lockedBox)
{
   printf("You can't, it is locked.\n");
}
...
```

æ˜¾ç„¶ï¼Œä»£ç çš„è¡Œæ•°ä¸æ¸¸æˆä¸­çš„é—¨ï¼ˆä»¥åŠç›’å­å’Œå…¶ä»–å¯ä»¥æ‰“å¼€çš„ç‰©ä½“ï¼‰çš„æ•°é‡æˆæ­£æ¯”ã€‚å› æ­¤ï¼Œå¦‚æœä½ çš„æ¸¸æˆæœ‰ä¸æ­¢å‡ æ‰‡é—¨ï¼Œé‚£ä¹ˆé€‰æ‹©ä¸€ä¸ªæ›´é€šç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ªå¥½ä¸»æ„ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™å¯¹æ¯ä¸€ä¸ªå‘½ä»¤éƒ½æ˜¯é€‚ç”¨çš„ï¼šå½“å®ƒæ¶‰åŠåˆ°è®¸å¤šç‰©ä½“æ—¶ï¼Œå°½é‡å†™é€šç”¨ä»£ç ï¼›ä½†å½“ä½ å¤„ç†ä¸€ä¸¤ä¸ªç‰¹æ®Šæƒ…å†µæ—¶ï¼Œå°±åšæŒä½¿ç”¨ç›´æ¥çš„ã€ä¸“é—¨çš„ä»£ç ã€‚

::: warning ğŸ¤” æ€è€ƒé¢˜ï¼š
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ

æç¤ºï¼šC++ ä¸­çš„æ¨¡æ¿åŠŸèƒ½ï¼ˆè¿™åªæ˜¯ä¸€ç§é€‰æ‹©ï¼‰

ä¸‹é¢æˆ‘ä»¬å°†æ­æ™“ç­”æ¡ˆ
:::

é€šç”¨ä»£ç é€šå¸¸å¸¦æœ‰æ•°æ®é©±åŠ¨çš„æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦å‘æˆ‘ä»¬çš„å¯¹è±¡ç»“æ„æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚åœ¨è¿™ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬å¸Œæœ›æ”¯æŒçš„æ¯ä¸ªå‘½ä»¤æ·»åŠ ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼šæ‰“å¼€ã€å…³é—­ã€é”å®šå’Œè§£é”ã€‚

## object.txt

```c
#include <stdbool.h>
#include <stdio.h>
#include "object.h"
#include "toggle.h"

typedef struct object {
   bool         (*condition)(void);
   const char    *description;
   const char   **tags;
   struct object *location;
   struct object *destination;
   struct object *prospect;
   const char    *details;
   const char    *contents;
   const char    *textGo;
   int            weight;
   int            capacity;
   int            health;
   void         (*open)(void);
   void         (*close)(void);
   void         (*lock)(void);
   void         (*unlock)(void);
} OBJECT;

extern OBJECT objs[];

- field
     description "an open field"
     tags        "field"
     details     "The field is a nice and quiet place under a clear blue sky."
     capacity    9999

- cave
     description "a little cave"
     tags        "cave"
     details     "The cave is just a cold, damp, rocky chamber."
     capacity    9999

- silver
     description "a silver coin"
     tags        "silver", "coin", "silver coin"
     location    field
     details     "The coin has an eagle on the obverse."
     weight      1

- gold
     description "a gold coin"
     tags        "gold", "coin", "gold coin"
     location    openBox
     details     "The shiny coin seems to be a rare and priceless artefact."
     weight      1

- guard
     description "a burly guard"
     tags        "guard", "burly guard"
     location    field
     details     "The guard is a really big fellow."
     contents    "He has"
     health      100
     capacity    20

- player
     description "yourself"
     tags        "yourself"
     location    field
     details     "You would need a mirror to look at yourself."
     contents    "You have"
     health      100
     capacity    20

- intoCave
     condition   { return guard->health == 0 || silver->location == guard; }
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     destination cave
     details     "The entrance is just a narrow opening in a small outcrop."
     textGo      "You walk into the cave."
     open        isAlreadyOpen

- intoCaveBlocked
     condition   { return guard->health > 0 && silver->location != guard; }
     description "a cave entrance to the east"
     tags        "east", "entrance"
     location    field
     prospect    cave
     details     "The entrance is just a narrow opening in a small outcrop."
     textGo      "The guard stops you from walking into the cave."
     open        isAlreadyOpen

- exitCave
     description "an exit to the west"
     tags        "west", "exit"
     location    cave
     destination field
     details     "Sunlight pours in through an opening in the cave's wall."
     textGo      "You walk out of the cave."
     open        isAlreadyOpen

- wallField
     description "dense forest all around"
     tags        "west", "north", "south", "forest"
     location    field
     details     "The field is surrounded by trees and undergrowth."
     textGo      "Dense forest is blocking the way."

- wallCave
     description "solid rock all around"
     tags        "east", "north", "rock"
     location    cave
     details     "Carved in stone is a secret password 'abccb'."
     textGo      "Solid rock is blocking the way."

- backroom
     description "a backroom"
     tags        "backroom"
     details     "The room is dusty and messy."
     capacity    9999

- wallBackroom
     description "solid rock all around"
     tags        "east", "west", "south", "rock"
     location    backroom
     details     "Trendy wallpaper covers the rock walls."
     textGo      "Solid rock is blocking the way."

- openDoorToBackroom
     description "an open door to the south"
     tags        "south", "door", "doorway"
     destination backroom
     details     "The door is open."
     textGo      "You walk through the door into a backroom."
     open        isAlreadyOpen
     close       toggleDoorToBackroom

- closedDoorToBackroom
     description "a closed door to the south"
     tags        "south", "door", "doorway"
     location    cave
     prospect    backroom
     details     "The door is closed."
     textGo      "The door is closed."
     open        toggleDoorToBackroom
     close       isAlreadyClosed

- openDoorToCave
     description "an open door to the north"
     tags        "north", "door", "doorway"
     destination cave
     details     "The door is open."
     textGo      "You walk through the door into the cave."
     open        isAlreadyOpen
     close       toggleDoorToCave

- closedDoorToCave
     description "a closed door to the north"
     tags        "north", "door", "doorway"
     location    backroom
     prospect    cave
     details     "The door is closed."
     textGo      "The door is closed."
     open        toggleDoorToCave
     close       isAlreadyClosed

- openBox
     description "a wooden box"
     tags        "box", "wooden box"
     details     "The box is open."
     weight      5
     capacity    10
     open        isAlreadyOpen
     close       toggleBox
     lock        isStillOpen
     unlock      isAlreadyOpen

- closedBox
     description "a wooden box"
     tags        "box", "wooden box"
     details     "The box is closed."
     weight      5
     open        toggleBox
     close       isAlreadyClosed
     lock        toggleBoxLock
     unlock      isAlreadyUnlocked

- lockedBox
     description "a wooden box"
     tags        "box", "wooden box"
     location    backroom
     details     "The box is closed."
     weight      5
     open        isStillLocked
     close       isAlreadyClosed
     lock        isAlreadyLocked
     unlock      toggleBoxLock

- keyForBox
     description "a tiny key"
     tags        "key", "tiny key"
     location    cave
     details     "The key is really small and shiny."
     weight      1
```

æ³¨æ„ï¼š

- ç¬¬ 89 è¡Œï¼šä¹ä¸€çœ‹ï¼ŒisAlreadyOpen åœ¨è¿™é‡Œä¼¼ä¹ä¸åˆé€‚ï¼›ä»æŠ€æœ¯ä¸Šè®²ï¼ŒintoCaveBlocked æ˜¯ä¸€ä¸ªå°é—­çš„é€šé“ã€‚ä½†ä»æ•…äº‹ä¸Šè®²ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸é”™çš„å¼€åœºç™½ã€‚
- ç¬¬ 169ã€180ã€191 è¡Œã€‚å¦‚æœä½ å–œæ¬¢æ²‰é‡çš„å®ç®±è€Œä¸æ˜¯ç›’å­ï¼Œé‚£ä¹ˆä½ æ‰€è¦åšçš„å°±æ˜¯å¢åŠ é‡é‡ï¼ˆå¹¶ç›¸åº”è°ƒæ•´ç›¸å…³æ–‡å­—å’Œæ ‡ç­¾ï¼‰ã€‚

ä¸ºäº†é¿å…é‡å¤çš„ä»£ç ï¼Œæˆ‘ä»¬è¿™æ¬¡ç‰¹æ„æ²¡æœ‰ä½¿ç”¨åŒ¿åå‡½æ•°ã€‚ç›¸åï¼Œæˆ‘ä»¬å°†åœ¨ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ä¸­å®ç°å¿…è¦çš„é€»è¾‘ã€‚å‡½æ•° swapLocations ä¹Ÿåœ¨å…¶ä¸­ï¼Œè¿™ä¸è¿‡æ˜¯ä¸€ä¸ªç¨å¾®æ‰©å±•çš„ç‰ˆæœ¬ï¼Œå®ƒä¹Ÿä¼šå‘ç”¨æˆ·è¾“å‡ºåé¦ˆã€‚

## toggle.h

```c
extern void cannotBeOpened(void);
extern void cannotBeClosed(void);
extern void cannotBeLocked(void);
extern void cannotBeUnlocked(void);

extern void isAlreadyOpen(void);
extern void isAlreadyClosed(void);
extern void isAlreadyLocked(void);
extern void isAlreadyUnlocked(void);

extern void isStillOpen(void);
extern void isStillLocked(void);

extern void toggleDoorToBackroom(void);
extern void toggleDoorToCave(void);
extern void toggleBox(void);
extern void toggleBoxLock(void);
```

## toggle.c

```c
#include <stdbool.h>
#include <stdio.h>
#include "object.h"

static void swapLocations(const char *verb1, OBJECT *obj1,
                          const char *verb2, OBJECT *obj2)
{
   OBJECT *tmp = obj1->location;
   OBJECT *obj = tmp != NULL ? obj1 : obj2;
   const char *verb = tmp != NULL ? verb1 : verb2;
   obj1->location = obj2->location;
   obj2->location = tmp;
   if (verb != NULL) printf("You %s %s.\n", verb, obj->description);
}

void cannotBeOpened(void)    { printf("That cannot be opened.\n");    }
void cannotBeClosed(void)    { printf("That cannot be closed.\n");    }
void cannotBeLocked(void)    { printf("That cannot be locked.\n");    }
void cannotBeUnlocked(void)  { printf("That cannot be unlocked.\n");  }

void isAlreadyOpen(void)     { printf("That is already open.\n");     }
void isAlreadyClosed(void)   { printf("That is already closed.\n");   }
void isAlreadyLocked(void)   { printf("That is already locked.\n");   }
void isAlreadyUnlocked(void) { printf("That is already unlocked.\n"); }

void isStillOpen(void)       { printf("That is still open.\n");       }
void isStillLocked(void)     { printf("That is locked.\n");           }

void toggleDoorToBackroom(void)
{
   swapLocations(NULL, openDoorToCave, NULL, closedDoorToCave);
   swapLocations("close", openDoorToBackroom, "open", closedDoorToBackroom);
}

void toggleDoorToCave(void)
{
   swapLocations(NULL, openDoorToBackroom, NULL, closedDoorToBackroom);
   swapLocations("close", openDoorToCave, "open", closedDoorToCave);
}

void toggleBox(void)
{
   swapLocations("close", openBox, "open", closedBox);
}

void toggleBoxLock(void)
{
   if (keyForBox->location == player)
   {
      swapLocations("lock", closedBox, "unlock", lockedBox);
   }
   else
   {
      printf("You don't have a key.\n");
   }
}
```

æ­£å¦‚å‰é¢æ‰€å®£å¸ƒçš„ï¼Œæ‰“å¼€ã€å…³é—­ã€é”å®šå’Œè§£é”è¿™å››ä¸ªå‘½ä»¤çš„å®ç°æ˜¯å®Œå…¨é€šç”¨çš„ã€‚

## openclose.h

```c
extern void executeOpen(const char *noun);
extern void executeClose(const char *noun);
extern void executeLock(const char *noun);
extern void executeUnlock(const char *noun);
```

## openclose.c

```c
#include <stdbool.h>
#include <stdio.h>
#include "object.h"
#include "reach.h"

void executeOpen(const char *noun)
{
   OBJECT *obj = reachableObject("what you want to open", noun);
   if (obj != NULL) (*obj->open)();
}

void executeClose(const char *noun)
{
   OBJECT *obj = reachableObject("what you want to close", noun);
   if (obj != NULL) (*obj->close)();
}

void executeLock(const char *noun)
{
   OBJECT *obj = reachableObject("what you want to lock", noun);
   if (obj != NULL) (*obj->lock)();
}

void executeUnlock(const char *noun)
{
   OBJECT *obj = reachableObject("what you want to unlock", noun);
   if (obj != NULL) (*obj->unlock)();
}
```

ä¸Šé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªé€šç”¨å‡½æ•° reachableObject æ¥å¤„ç†ä¸åœ¨è¿™é‡Œçš„å¯¹è±¡ï¼›å…¶å®ç°è§ä¸‹æ–‡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸å¿…æŠŠåŒæ ·çš„ä»£ç å†™å››éï¼ˆæ¯ä¸ªæ‰§è¡Œå‡½æ•°å†™ä¸€éï¼‰ã€‚æ›´å¤šçš„å‘½ä»¤å°†åœ¨ç¬¬ 15 ç« ä¸­åŠ å…¥ï¼›è¿™äº›å‘½ä»¤å°†å—ç›ŠäºåŒæ ·çš„å‡½æ•°ã€‚

## reach.h

```c
extern OBJECT *reachableObject(const char *intention, const char *noun);
```

## reach.c

```c
#include <stdbool.h>
#include <stdio.h>
#include "object.h"
#include "misc.h"
#include "noun.h"

OBJECT *reachableObject(const char *intention, const char *noun)
{
   OBJECT *obj = getVisible(intention, noun);
   switch (getDistance(player, obj))
   {
   case distSelf:
      printf("You should not be doing that to yourself.\n");
      break;
   case distHeldContained:
   case distHereContained:
      printf("You would have to get it from %s first.\n",
             obj->location->description);
      break;
   case distOverthere:
      printf("Too far away, move closer please.\n");
      break;
   case distNotHere:
   case distUnknownObject:
      // already handled by getVisible
      break;
   default:
      return obj;
   }
   return NULL;
}
```

åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿè¦å¯¹ parsexec.c è¿›è¡Œè¡¥å……

## parsexec.c

```c
#include <stdbool.h>
#include <stdio.h>
#include <string.h>
#include "location.h"
#include "inventory.h"
#include "openclose.h"

bool parseAndExecute(char *input)
{
   char *verb = strtok(input, " \n");
   char *noun = strtok(NULL, "\n");
   if (verb != NULL)
   {
      if (strcmp(verb, "quit") == 0)
      {
         return false;
      }
      else if (strcmp(verb, "look") == 0)
      {
         executeLook(noun);
      }
      else if (strcmp(verb, "go") == 0)
      {
         executeGo(noun);
      }
      else if (strcmp(verb, "get") == 0)
      {
         executeGet(noun);
      }
      else if (strcmp(verb, "drop") == 0)
      {
         executeDrop(noun);
      }
      else if (strcmp(verb, "give") == 0)
      {
         executeGive(noun);
      }
      else if (strcmp(verb, "ask") == 0)
      {
         executeAsk(noun);
      }
      else if (strcmp(verb, "inventory") == 0)
      {
         executeInventory();
      }
      else if (strcmp(verb, "open") == 0)
      {
         executeOpen(noun);
      }
      else if (strcmp(verb, "close") == 0)
      {
         executeClose(noun);
      }
      else if (strcmp(verb, "lock") == 0)
      {
         executeLock(noun);
      }
      else if (strcmp(verb, "unlock") == 0)
      {
         executeUnlock(noun);
      }
      else
      {
         printf("I don't know how to '%s'.\n", verb);
      }
   }
   return true;
}
```

æ³¨æ„ï¼š

- ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œobject.txt åœ¨æœ¬ç« ä¸­çš„å¤§å°å‡ ä¹å¢åŠ äº†ä¸€å€ã€‚æˆ‘ä»¬å·²ç»å¯ä»¥å‘ä½ ä¿è¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¼€å§‹ã€‚object.txt æ˜¯æˆ‘ä»¬æ¸¸æˆæ•°æ®çš„ä¸»è¦æ¥æºï¼›ä¸€æ—¦æˆ‘ä»¬è®¤çœŸå¼€å§‹æ·»åŠ åœ°ç‚¹ã€ç‰©å“å’Œæ¼”å‘˜ï¼Œè¡Œæ•°å¾ˆå®¹æ˜“å°±ä¼šå¢åŠ åˆ°æ•°åƒè¡Œã€‚
- é™¤äº†é—¨å’Œé”ä¹‹å¤–ï¼Œå‡½æ•° swapLocation è¿˜å¯ä»¥ç”¨äºè®¸å¤šå…¶ä»–äº‹æƒ…ã€‚åœ¨ç¬¬ 15 ç« ï¼Œå®ƒå°†å†æ¬¡è¢«ä½¿ç”¨ï¼Œè¿™æ¬¡æ˜¯ç”¨æ¥æ‰“å¼€å’Œå…³é—­ç¯ã€‚
- æ­£å¦‚ä½ åœ¨æ ·æœ¬è¾“å‡ºä¸­æ‰€çœ‹åˆ°çš„ï¼Œç©å®¶å¯ä»¥ä»ç›’å­é‡Œæ‹¿åˆ°é‡‘å­ï¼Œä½†ä»–æ— æ³•å†æŠŠé‡‘å­æ”¾å›å»ï¼æˆ‘ä»¬çš„è§£æå™¨æ— æ³•å¤„ç†åƒæŠŠç¡¬å¸æ”¾è¿›ç›’å­è¿™æ ·çš„ "å¤æ‚ "å‘½ä»¤ã€‚å› æ­¤ï¼Œåœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå…¨æ–°çš„è§£æå™¨ï¼šç›®å‰çš„åŒçº¿å®ç°æ€¥éœ€æ›´æ¢ï¼

è¾“å‡ºæ ·ä¾‹

Welcome to Little Cave Adventure.
You are in an open field.
You see:
a silver coin
a burly guard
a cave entrance to the east
dense forest all around

--> get coin
You pick up a silver coin.

--> give coin
You give a silver coin to a burly guard.

--> go cave
You walk into the cave.

You are in a little cave.
You see:
an exit to the west
solid rock all around
a closed door to the south
a tiny key

--> get key
You pick up a tiny key.

--> go south
The door is closed.

--> open door
You open a closed door to the south.

--> go south
You walk through the door into a backroom.

You are in a backroom.
You see:
solid rock all around
an open door to the north
a wooden box

--> unlock box
You unlock a wooden box.

--> open box
You open a wooden box.

--> look box
The box is open.
You see:
a gold coin

--> get gold
You get a gold coin from a wooden box.

--> quit

Bye!
